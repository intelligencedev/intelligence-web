<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aeternis - intelligence.dev</title>
    <style>
      body {
        margin: 0;
      }

      canvas {
        display: block;
      }

      #email-icon {
        position: fixed;
        bottom: 10px;
        right: 10px;
        padding: 8px;
        cursor: pointer;
        background: transparent;
        border-radius: 5px;
        transition: background 0.3s ease;
      }

      #email-icon:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      #email-icon svg {
        width: 24px;
        height: 24px;
      }

      #parameters-button {
        position: fixed;
        top: 10px;
        left: 10px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      #parameters-menu {
        display: none;
        position: fixed;
        top: 50px;
        left: 10px;
        background: rgba(0, 0, 0, 0.8);
        padding: 15px;
        border-radius: 5px;
        color: white;
        max-height: 80vh;
        overflow-y: auto;
        min-width: 250px;
      }

      .parameter-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .parameter-row label {
        flex: 1;
        margin-right: 10px;
        font-size: 12px;
      }

      .parameter-row input[type="range"] {
        flex: 2;
        margin-right: 8px;
      }

      .parameter-row input[type="color"] {
        flex: 1;
        margin-right: 8px;
        height: 25px;
        border: none;
        border-radius: 3px;
      }

      .parameter-value {
        flex: 0 0 auto;
        min-width: 45px;
        text-align: right;
        font-size: 11px;
        color: #ccc;
      }

      .parameter-section {
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 10px;
        margin-bottom: 10px;
      }

      .parameter-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .section-title {
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 13px;
        color: #fff;
      }

      /* Camera Info Style */
      #camera-info {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        font-size: 13px;
        padding: 7px 12px;
        border-radius: 6px;
        z-index: 1000;
        font-family: monospace;
        pointer-events: none;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.177.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.177.0/examples/jsm/"
        }
      }
    </script>
  </head>

  <body>
    <!-- Email Contact Icon -->
    <div
      id="email-icon"
      onclick="window.location.href='mailto:admin@intelligence.dev'"
    >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          fill="none"
          stroke="#D3D3D3"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="m4 6l6.108 4.612l.002.002c.678.497 1.017.746 1.389.842a2 2 0 0 0 1.002 0c.372-.096.712-.345 1.392-.844c0 0 3.917-3.006 6.107-4.612M3 15.8V8.2c0-1.12 0-1.68.218-2.108c.192-.377.497-.682.874-.874C4.52 5 5.08 5 6.2 5h11.6c1.12 0 1.68 0 2.107.218c.377.192.683.497.875.874c.218.427.218.987.218 2.105v7.607c0 1.118 0 1.676-.218 2.104a2.002 2.002 0 0 1-.875.874c-.427.218-.986.218-2.104.218H6.197c-1.118 0-1.678 0-2.105-.218a2 2 0 0 1-.874-.874C3 17.48 3 16.92 3 15.8Z"
        />
      </svg>
    </div>

    <!-- Camera Info Display (bottom left) -->
    <div id="camera-info">
      Camera: x: 0.00, y: 0.00, z: 0.00<br />Rotation: x: 0.00, y: 0.00, z: 0.00
    </div>

    <!-- Parameters Button -->
    <button id="parameters-button">Parameters</button>
    <div id="parameters-menu">
      <div class="parameter-section">
        <div class="section-title">Galaxy Parameters</div>
        <div class="parameter-row">
          <label for="numStars">Stars</label>
          <input
            type="range"
            id="numStars"
            min="1000"
            max="200000"
            value="55000"
            step="1000"
          />
          <span class="parameter-value" id="numStars-value">55000</span>
        </div>
        <div class="parameter-row">
          <label for="starSize">Star Size</label>
          <input
            type="range"
            id="starSize"
            min="0.0004"
            max="0.01"
            value="0.002"
            step="0.0002"
          />
          <span class="parameter-value" id="starSize-value">0.002</span>
        </div>
        <div class="parameter-row">
          <label for="galacticRadius">Galactic Radius</label>
          <input
            type="range"
            id="galacticRadius"
            min="1"
            max="20"
            value="2.07"
            step="0.1"
          />
          <span class="parameter-value" id="galacticRadius-value">2.07</span>
        </div>
        <div class="parameter-row">
          <label for="spiralArms">Spiral Arms</label>
          <input
            type="range"
            id="spiralArms"
            min="1"
            max="8"
            step="1"
            value="5"
          />
          <span class="parameter-value" id="spiralArms-value">5</span>
        </div>
        <div class="parameter-row">
          <label for="coreRadius">Core Radius</label>
          <input
            type="range"
            id="coreRadius"
            min="0.001"
            max="10"
            value="2"
            step="0.01"
          />
          <span class="parameter-value" id="coreRadius-value">2</span>
        </div>
        <div class="parameter-row">
          <label for="orbitalTimeScale">Orbital Speed</label>
          <input
            type="range"
            id="orbitalTimeScale"
            min="0.1"
            max="10"
            value="1.7"
            step="0.1"
          />
          <span class="parameter-value" id="orbitalTimeScale-value">1.7</span>
        </div>
        <div class="parameter-row">
          <label for="discScaleLength">Disc Scale Length</label>
          <input
            type="range"
            id="discScaleLength"
            min="0.1"
            max="1"
            value="0.31"
            step="0.01"
          />
          <span class="parameter-value" id="discScaleLength-value">0.31</span>
        </div>
        <div class="parameter-row">
          <label for="bulgeRadius">Bulge Radius</label>
          <input
            type="range"
            id="bulgeRadius"
            min="0.05"
            max="0.5"
            step="0.01"
            value="0.05"
          />
          <span class="parameter-value" id="bulgeRadius-value">0.05</span>
        </div>
        <div class="parameter-row">
          <label for="verticalScaleHeight">Vertical Scale Height</label>
          <input
            type="range"
            id="verticalScaleHeight"
            min="0.005"
            max="0.2"
            value="0.02"
            step="0.001"
          />
          <span class="parameter-value" id="verticalScaleHeight-value"
            >0.02</span
          >
        </div>
        <div class="parameter-row">
          <label for="spiralPitchAngle">Spiral Pitch Angle</label>
          <input
            type="range"
            id="spiralPitchAngle"
            min="8"
            max="20"
            step="0.5"
            value="20"
          />
          <span class="parameter-value" id="spiralPitchAngle-value">20</span>
        </div>
        <div class="parameter-row">
          <label for="clusterInfluence">Cluster Influence</label>
          <input
            type="range"
            id="clusterInfluence"
            min="0"
            max="3"
            value="0.08"
            step="0.01"
          />
          <span class="parameter-value" id="clusterInfluence-value">0.08</span>
        </div>
      </div>
      <div class="parameter-section">
        <div class="section-title">Background Starfield</div>
        <div class="parameter-row">
          <label for="backgroundStarCount">Star Count</label>
          <input
            type="range"
            id="backgroundStarCount"
            min="1000"
            max="150000"
            value="150000"
            step="1000"
          />
          <span class="parameter-value" id="backgroundStarCount-value"
            >150000</span
          >
        </div>
        <div class="parameter-row">
          <label for="backgroundStarInnerRadius">Inner Radius</label>
          <input
            type="range"
            id="backgroundStarInnerRadius"
            min="5"
            max="200"
            value="5"
            step="1"
          />
          <span class="parameter-value" id="backgroundStarInnerRadius-value"
            >5</span
          >
        </div>
        <div class="parameter-row">
          <label for="backgroundStarOuterRadius">Outer Radius</label>
          <input
            type="range"
            id="backgroundStarOuterRadius"
            min="10"
            max="400"
            value="10"
            step="2"
          />
          <span class="parameter-value" id="backgroundStarOuterRadius-value"
            >10</span
          >
        </div>
        <div class="parameter-row">
          <label for="backgroundStarSize">Star Size</label>
          <input
            type="range"
            id="backgroundStarSize"
            min="0.001"
            max="0.05"
            value="0.023"
            step="0.001"
          />
          <span class="parameter-value" id="backgroundStarSize-value"
            >0.023</span
          >
        </div>
      </div>
      <div class="parameter-section">
        <div class="section-title">Nebula Parameters</div>
        <div class="parameter-row">
          <label for="baseRadius">Nebula Base Radius</label>
          <input
            type="range"
            id="baseRadius"
            min="0.01"
            max="0.3"
            value="0.1"
            step="0.01"
          />
          <span class="parameter-value" id="baseRadius-value">0.1</span>
        </div>
        <div class="parameter-row">
          <label for="armWidth">Nebula Arm Width</label>
          <input
            type="range"
            id="armWidth"
            min="0.001"
            max="3"
            value="0.73"
            step="0.01"
          />
          <span class="parameter-value" id="armWidth-value">0.73</span>
        </div>
        <div class="parameter-row">
          <label for="armDensityMultiplier">Nebula Arm Density</label>
          <input
            type="range"
            id="armDensityMultiplier"
            min="0"
            max="3"
            value="1"
            step="0.1"
          />
          <span class="parameter-value" id="armDensityMultiplier-value">1</span>
        </div>
        <div class="parameter-row">
          <label for="densityFactor">Nebula Density</label>
          <input
            type="range"
            id="densityFactor"
            min="0"
            max="5"
            value="1.1"
            step="0.1"
          />
          <span class="parameter-value" id="densityFactor-value">1.1</span>
        </div>
        <div class="parameter-row">
          <label for="nebulaCoolColor">Nebula Cool Color</label>
          <input type="color" id="nebulaCoolColor" value="#1f47f2" />
          <span class="parameter-value" id="nebulaCoolColor-value"
            >#1f47f2</span
          >
        </div>
        <div class="parameter-row">
          <label for="nebulaDustColor">Nebula Dust Color</label>
          <input type="color" id="nebulaDustColor" value="#8c401f" />
          <span class="parameter-value" id="nebulaDustColor-value"
            >#8c401f</span
          >
        </div>
        <div class="parameter-row">
          <label for="nebulaWarmColor">Nebula Warm Color</label>
          <input type="color" id="nebulaWarmColor" value="#ffdbb3" />
          <span class="parameter-value" id="nebulaWarmColor-value"
            >#ffdbb3</span
          >
        </div>
        <div class="parameter-row">
          <label for="rayMarchSteps">Ray March Steps</label>
          <input
            type="range"
            id="rayMarchSteps"
            min="4"
            max="200"
            value="32"
            step="4"
          />
          <span class="parameter-value" id="rayMarchSteps-value">32</span>
        </div>
        <div class="parameter-row">
          <label for="absorptionCoefficient">Absorption</label>
          <input
            type="range"
            id="absorptionCoefficient"
            min="0"
            max="10"
            value="5"
            step="0.1"
          />
          <span class="parameter-value" id="absorptionCoefficient-value"
            >5</span
          >
        </div>
        <div class="parameter-row">
          <label for="scatteringCoefficient">Scattering</label>
          <input
            type="range"
            id="scatteringCoefficient"
            min="0"
            max="30"
            value="20"
            step="0.5"
          />
          <span class="parameter-value" id="scatteringCoefficient-value"
            >20</span
          >
        </div>
        <div class="parameter-row">
          <label for="centralLightIntensity">Central Light Intensity</label>
          <input
            type="range"
            id="centralLightIntensity"
            min="0"
            max="5"
            value="1.2"
            step="0.1"
          />
          <span class="parameter-value" id="centralLightIntensity-value"
            >1.2</span
          >
        </div>

        <div class="parameter-section">
          <div class="section-title">Black Hole</div>
          <div class="parameter-row">
            <label for="blackHoleEnabled">Enabled</label>
            <input type="range" id="blackHoleEnabled" min="0" max="1" value="1" step="1" />
            <span class="parameter-value" id="blackHoleEnabled-value">1</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleMass">Mass</label>
            <input type="range" id="blackHoleMass" min="0" max="5" value="0" step="0.05" />
            <span class="parameter-value" id="blackHoleMass-value">0</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleLensStrength">Lens Strength</label>
            <input type="range" id="blackHoleLensStrength" min="0" max="3" value="0" step="0.05" />
            <span class="parameter-value" id="blackHoleLensStrength-value">0</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleHorizonRadius">Horizon Radius</label>
            <input type="range" id="blackHoleHorizonRadius" min="0.005" max="0.2" value="0.005" step="0.001" />
            <span class="parameter-value" id="blackHoleHorizonRadius-value">0.005</span>
          </div>
          <div class="parameter-row">
            <label for="blackHolePhotonRingRadius">Photon Ring Radius</label>
            <input type="range" id="blackHolePhotonRingRadius" min="0.01" max="0.3" value="0.01" step="0.001" />
            <span class="parameter-value" id="blackHolePhotonRingRadius-value">0.01</span>
          </div>
          <div class="parameter-row">
            <label for="blackHolePhotonRingWidth">Photon Ring Width</label>
            <input type="range" id="blackHolePhotonRingWidth" min="0.001" max="0.08" value="0.008" step="0.001" />
            <span class="parameter-value" id="blackHolePhotonRingWidth-value">0.008</span>
          </div>
          <div class="parameter-row">
            <label for="blackHolePhotonRingIntensity">Photon Ring Intensity</label>
            <input type="range" id="blackHolePhotonRingIntensity" min="0" max="5" value="0.15" step="0.05" />
            <span class="parameter-value" id="blackHolePhotonRingIntensity-value">0.15</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleAccretionIntensity">Accretion Intensity</label>
            <input type="range" id="blackHoleAccretionIntensity" min="0" max="5" value="0.05" step="0.05" />
            <span class="parameter-value" id="blackHoleAccretionIntensity-value">0.05</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleAccretionRadius">Accretion Radius</label>
            <input type="range" id="blackHoleAccretionRadius" min="0.02" max="0.5" value="0.03" step="0.005" />
            <span class="parameter-value" id="blackHoleAccretionRadius-value">0.03</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleAccretionWidth">Accretion Width</label>
            <input type="range" id="blackHoleAccretionWidth" min="0.001" max="0.15" value="0.031" step="0.002" />
            <span class="parameter-value" id="blackHoleAccretionWidth-value">0.031</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleDiskInclination">Disk Inclination</label>
            <input type="range" id="blackHoleDiskInclination" min="0" max="1" value="0.24" step="0.01" />
            <span class="parameter-value" id="blackHoleDiskInclination-value">0.24</span>
          </div>
          <div class="parameter-row">
            <label for="blackHoleDopplerStrength">Doppler Beaming</label>
            <input type="range" id="blackHoleDopplerStrength" min="0" max="2" value="0.72" step="0.02" />
            <span class="parameter-value" id="blackHoleDopplerStrength-value">0.72</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Load Three.js and additional scripts for post-processing -->
    <script type="module" src="src/app.js"></script>
    <script>
      // Parameter menu toggle
      const paramBtn = document.getElementById("parameters-button");
      const paramMenu = document.getElementById("parameters-menu");
      paramBtn.addEventListener("click", () => {
        paramMenu.style.display =
          paramMenu.style.display === "block" ? "none" : "block";
      });

      // Slider bindings for galaxyParams
      const paramDefs = [
        { id: "numStars", key: "numStars", type: "int" },
        { id: "starSize", key: "starSize", type: "float" },
        { id: "galacticRadius", key: "galacticRadius", type: "float" },
        { id: "spiralArms", key: "spiralArms", type: "int" },
        { id: "coreRadius", key: "coreRadius", type: "float" },
        { id: "orbitalTimeScale", key: "orbitalTimeScale", type: "float" },
        { id: "discScaleLength", key: "discScaleLength", type: "float" },
        { id: "bulgeRadius", key: "bulgeRadius", type: "float" },
        {
          id: "verticalScaleHeight",
          key: "verticalScaleHeight",
          type: "float",
        },
        { id: "spiralPitchAngle", key: "spiralPitchAngle", type: "float" },
        { id: "clusterInfluence", key: "clusterInfluence", type: "float" },
        // Background Starfield
        { id: "backgroundStarCount", key: "backgroundStarCount", type: "int" },
        {
          id: "backgroundStarInnerRadius",
          key: "backgroundStarInnerRadius",
          type: "float",
        },
        {
          id: "backgroundStarOuterRadius",
          key: "backgroundStarOuterRadius",
          type: "float",
        },
        { id: "backgroundStarSize", key: "backgroundStarSize", type: "float" },
        // New Nebula Params
        { id: "baseRadius", key: "baseRadius", type: "float" },
        { id: "armWidth", key: "armWidth", type: "float" },
        {
          id: "armDensityMultiplier",
          key: "armDensityMultiplier",
          type: "float",
        },
        // Existing Nebula/Volume Params
        { id: "densityFactor", key: "densityFactor", type: "float" },
        // Nebula palette
        { id: "nebulaCoolColor", key: "nebulaCoolColor", type: "color" },
        { id: "nebulaDustColor", key: "nebulaDustColor", type: "color" },
        { id: "nebulaWarmColor", key: "nebulaWarmColor", type: "color" },
        { id: "rayMarchSteps", key: "rayMarchSteps", type: "int" },
        {
          id: "absorptionCoefficient",
          key: "absorptionCoefficient",
          type: "float",
        },
        {
          id: "scatteringCoefficient",
          key: "scatteringCoefficient",
          type: "float",
        },
        {
          id: "centralLightIntensity",
          key: "centralLightIntensity",
          type: "float",
        },

        // Black Hole
        { id: "blackHoleEnabled", key: "blackHoleEnabled", type: "int" },
        { id: "blackHoleMass", key: "blackHoleMass", type: "float" },
        { id: "blackHoleLensStrength", key: "blackHoleLensStrength", type: "float" },
        { id: "blackHoleHorizonRadius", key: "blackHoleHorizonRadius", type: "float" },
        { id: "blackHolePhotonRingRadius", key: "blackHolePhotonRingRadius", type: "float" },
        { id: "blackHolePhotonRingWidth", key: "blackHolePhotonRingWidth", type: "float" },
        { id: "blackHolePhotonRingIntensity", key: "blackHolePhotonRingIntensity", type: "float" },
        { id: "blackHoleAccretionIntensity", key: "blackHoleAccretionIntensity", type: "float" },
        { id: "blackHoleAccretionRadius", key: "blackHoleAccretionRadius", type: "float" },
        { id: "blackHoleAccretionWidth", key: "blackHoleAccretionWidth", type: "float" },
        { id: "blackHoleDiskInclination", key: "blackHoleDiskInclination", type: "float" },
        { id: "blackHoleDopplerStrength", key: "blackHoleDopplerStrength", type: "float" },
      ];

      // Wait for script.js to load and galaxyParams to be available
      function updateSliderBindings() {
        if (typeof window.galaxyParams === "undefined") {
          setTimeout(updateSliderBindings, 100);
          return;
        }
        paramDefs.forEach((def) => {
          const slider = document.getElementById(def.id);
          const valueSpan = document.getElementById(def.id + "-value");
          if (!slider || !valueSpan) return;

          // Initialize UI from the canonical defaults in window.galaxyParams.
          if (Object.prototype.hasOwnProperty.call(window.galaxyParams, def.key)) {
            const initial = window.galaxyParams[def.key];
            if (def.type === "color") {
              slider.value = initial;
              valueSpan.textContent = slider.value;
            } else {
              slider.value = String(initial);
              valueSpan.textContent = String(initial);
            }
          }
          slider.addEventListener("input", (e) => {
            let val;
            if (def.type === "color") {
              val = e.target.value; // Keep as hex string
              valueSpan.textContent = val;
            } else {
              val =
                def.type === "int"
                  ? parseInt(e.target.value)
                  : parseFloat(e.target.value);
              valueSpan.textContent = val;
            }
            window.galaxyParams[def.key] = val;
            if (window.handleParamChange)
              window.handleParamChange(def.key, val);
          });
        });
      }
      // Expose galaxyParams for menu
      window.addEventListener("DOMContentLoaded", () => {
        updateSliderBindings();
      });
    </script>
  </body>
</html>
